#!/bin/bash

SOFTWARE_FOLDER="$HOME/software"

createSoftwareFolder(){  
  mkdir -p $SOFTWARE_FOLDER
}

install-keycloak(){

  createSoftwareFolder

  KEYCLOAK_VERSION=17.0.0
  KEYCLOAK_FILENAME=keycloak-$KEYCLOAK_VERSION
  KEYCLOAK_ARCHIVE_NAME=$KEYCLOAK_FILENAME.tar.gz
  KEYCLOAK_ARCHIVE_PATH="$SOFTWARE_FOLDER/$KEYCLOAK_FILENAME.tar.gz"
  KEYCLOAK_DOWNLOAD_ADDRESS=https://github.com/keycloak/keycloak/releases/download/$KEYCLOAK_VERSION/$KEYCLOAK_ARCHIVE_NAME
  KEYCLOAK_INSTALL_DIR="/opt/keycloak"
    
  if [ ! -e "$KEYCLOAK_ARCHIVE_PATH" ]; then
    echo "Downloading: $KEYCLOAK_DOWNLOAD_ADDRESS..."
    echo "Download location: $KEYCLOAK_ARCHIVE_PATH"
    wget -q -P $SOFTWARE_FOLDER $KEYCLOAK_DOWNLOAD_ADDRESS
    if [ $? -ne 0 ]; then
      echo "Not possible to download Keycloak."
      exit 1
    fi
  else
    echo "Keycloak archive already exists."  
  fi

  if [ ! -d "$KEYCLOAK_INSTALL_DIR" ]; then
    sudo mkdir -p $KEYCLOAK_INSTALL_DIR
    sudo chown $LOGNAME:$LOGNAME -R $KEYCLOAK_INSTALL_DIR
  fi

  if [ ! -d "$KEYCLOAK_INSTALL_DIR/$KEYCLOAK_FILENAME" ]; then
    tar -xzf $KEYCLOAK_ARCHIVE_PATH -C $KEYCLOAK_INSTALL_DIR
  else
    echo "$KEYCLOAK_FILENAME is already installed"
  fi  

  echo ""
  echo "---------------------------------------"
  printf "\033[32mKeycloak $KEYCLOAK_VERSION installed\033[39m\n"  
  echo ""
  echo "To start Keycloak please use :"
  echo " cd $KEYCLOAK_INSTALL_DIR/$KEYCLOAK_FILENAME"
  echo " bin/kc.sh start-dev"
  echo ""
  echo "https://www.keycloak.org/getting-started/getting-started-zip#_start_keycloak"
  echo ""
  echo "---------------------------------------"

}

install-wildfly(){

  createSoftwareFolder

  WILDFLY_VERSION=26.0.1.Final
  WILDFLY_FILENAME=wildfly-$WILDFLY_VERSION
  WILDFLY_ARCHIVE_NAME=$WILDFLY_FILENAME.tar.gz
  WILDFLY_ARCHIVE_PATH="$SOFTWARE_FOLDER/$WILDFLY_FILENAME.tar.gz"
  WILDFLY_DOWNLOAD_ADDRESS=https://github.com/wildfly/wildfly/releases/download/$WILDFLY_VERSION/$WILDFLY_ARCHIVE_NAME                           
  WILDFLY_INSTALL_DIR="/opt/wildfly"
    
  if [ ! -e "$WILDFLY_ARCHIVE_PATH" ]; then
    echo "Downloading: $WILDFLY_DOWNLOAD_ADDRESS..."
    echo "Download location: $WILDFLY_ARCHIVE_PATH"
    wget -P $SOFTWARE_FOLDER $WILDFLY_DOWNLOAD_ADDRESS
    if [ $? -ne 0 ]; then
      echo "Not possible to download Wildfly."
      exit 1
    fi
  else
    echo "Wildfly archive already exists."
  fi

  if [ ! -d "$WILDFLY_INSTALL_DIR" ]; then
    sudo mkdir -p $WILDFLY_INSTALL_DIR
    sudo chown $LOGNAME:$LOGNAME -R $WILDFLY_INSTALL_DIR
  fi

  if [ ! -d "$WILDFLY_INSTALL_DIR/$WILDFLY_FILENAME" ]; then
    tar -xzf $WILDFLY_ARCHIVE_PATH -C $WILDFLY_INSTALL_DIR
  else
    echo "$WILDFLY_FILENAME is already installed"
  fi

  echo ""
  echo "---------------------------------------"
  printf "\033[32mWildfly $WILDFLY_FILENAME installed\033[39m\n"
  echo ""
  echo "To start Wildfly please use :"
  echo " cd $WILDFLY_INSTALL_DIR/$WILDFLY_FILENAME"  
  echo " bin/standalone.sh"
  echo ""
  echo "https://github.com/jboss-developer/jboss-developer-shared-resources/blob/master/guides/START_JBOSS_EAP.adoc#start_the_jboss_eap_server"
  echo ""
  echo "---------------------------------------"

}

install-jdk(){

  JDK_VERSION=$1

  echo "JDK_VERSION : $JDK_VERSION"

  case $JDK_VERSION in
    17.0.2)
      ADOPTIUM_TOP_VERSION=17
      ADOPTIUM_SUB_VERSION=jdk-17.0.2%2B8
      ADOPTIUM_FOLDER=jdk-17.0.2+8
      ADOPTIUM_ARCHIVE_NAME=OpenJDK17U-jdk_x64_linux_hotspot_17.0.2_8.tar.gz
    ;;
    
    11.0.14)
      ADOPTIUM_TOP_VERSION=11
      ADOPTIUM_SUB_VERSION=jdk-11.0.14.1%2B1
      ADOPTIUM_FOLDER=jdk-11.0.14.1+1
      ADOPTIUM_ARCHIVE_NAME=OpenJDK11U-jdk_x64_linux_hotspot_11.0.14.1_1.tar.gz
    ;;

    8u322b06)
      ADOPTIUM_TOP_VERSION=8
      ADOPTIUM_SUB_VERSION=jdk8u322-b06
      ADOPTIUM_FOLDER=jdk8u322-b06
      ADOPTIUM_ARCHIVE_NAME=OpenJDK8U-jdk_x64_linux_hotspot_8u322b06.tar.gz
    ;;

    *)
      ADOPTIUM_TOP_VERSION=17
      ADOPTIUM_SUB_VERSION=jdk-17.0.2%2B8
      ADOPTIUM_FOLDER=jdk-17.0.2+8
      ADOPTIUM_ARCHIVE_NAME=OpenJDK17U-jdk_x64_linux_hotspot_17.0.2_8.tar.gz
    ;;
  esac
  
  JAVA_INSTALL_DIR="/opt/java"
  JDK_BASE_URL="https://github.com/adoptium/temurin"$ADOPTIUM_TOP_VERSION"-binaries/releases/download/$ADOPTIUM_SUB_VERSION/$ADOPTIUM_ARCHIVE_NAME"
  
  JDK_ARCHIVE_PATH="$SOFTWARE_FOLDER/$ADOPTIUM_ARCHIVE_NAME"
  
  echo "ADOPTIUM_ARCHIVE_NAME : $ADOPTIUM_ARCHIVE_NAME"
  echo "JDK_ARCHIVE_PATH : $JDK_ARCHIVE_PATH"

  if [ ! -f "$JDK_ARCHIVE_PATH" ]; then
    wget -P $SOFTWARE_FOLDER $JDK_BASE_URL
  fi

  if [ ! -d "$JAVA_INSTALL_DIR" ]; then
    sudo mkdir -p $JAVA_INSTALL_DIR
    sudo chown $LOGNAME:$LOGNAME -R $JAVA_INSTALL_DIR
  fi
  
  if [ ! -d "$JAVA_INSTALL_DIR/$ADOPTIUM_FOLDER" ]; then
    tar -xzf $ADOPTIUM_FOLDER -C $JAVA_INSTALL_DIR
  else
    echo "$ADOPTIUM_FOLDER is already installed"
  fi

}

install-jdk8(){
  echo "Starting to install jdk8"
  install-jdk 8u322b06
}

install-jdk11(){
  echo "Starting to install jdk11"
  install-jdk 11.0.14
}

install-jdk17(){
  echo "Starting to install jdk17"
  install-jdk 17.0.2
}